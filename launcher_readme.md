# Лаунчер Gigabah (Обновлено: GitHub Releases)

Этот файл описывает упрощённую модель обновления: больше НЕ нужен `manifest.json`. 
Версия игры = тег релиза (GitHub Release tag). Лаунчер обращается к API
`/repos/<owner>/<repo>/releases/latest`, сравнивает локальную версию и тег,
затем скачивает первый ZIP asset релиза и распаковывает его в `game/`.

## 1. Структура
```
launcher/                <- проект лаунчера Godot
  project.godot
  scenes/Launcher.tscn
  scripts/
    launcher.gd
    update_manager.gd
  manifest_example.json  <- пример формата
  README_LAUNCHER.md     <- общая англ. дока
  launcher_readme.md     <- текущий файл (rus, практические шаги)
```
Корень репозитория после обновлений будет иметь папку `game/` (создаётся лаунчером при установке билда).

## 2. Что нужно НАСТРОИТЬ
| Что | Где | Описание |
|-----|-----|----------|
| `GITHUB_OWNER` | `launcher/scripts/update_manager.gd` | Владелец репозитория с релизами |
| `GITHUB_REPO` | `launcher/scripts/update_manager.gd` | Название репозитория |
| Теги релизов | GitHub Releases | Используйте SemVer `v0.1.0` или `0.1.0` (префикс `v` удаляется автоматически) |
| ZIP asset | GitHub Release assets | Первый *.zip в списке будет скачан (добавьте только один для Windows) |
| Описание релиза | Release body | Показывается как changelog (Markdown → упрощённый BBCode) |

Не требуется: manifest.json, sha256, список патчей.

## 3. Подготовка первой ПОЛНОЙ сборки (через релиз)
1. Открой проект игры (НЕ лаунчер) в Godot → экспортируй Windows билд (например в `build_windows/`).
2. Убедись, что в корне экспортированных файлов присутствует файл с exe (например `Godessa.exe`).
3. (Опционально) Создай локально `version.json` — лаунчер перезапишет его сам, не критично.
4. Упакуй содержимое папки (без дополнительного корневого слоя) в `gigabah_0.1.0.zip`.
5. Создай GitHub Release:
   - Tag: `v0.1.0` (или `0.1.0`).
   - Title: `0.1.0`.
   - Body: список изменений (Markdown).
   - Прикрепи `gigabah_0.1.0.zip` как asset.
6. Сохрани релиз (не как draft). Лаунчер при следующем запуске увидит его.

## 4. Хостинг
Достаточно GitHub Releases. Дополнительный CDN можно подключить позже (например, зеркалируя ZIP).

## 5. Проверка локально (быстрый сценарий)
1. Запусти лаунчер проект (`launcher/project.godot`).
2. Убедись, что без `game/` он показывает отсутствие локальной версии и скачивает.
3. После скачивания появится папка `game/` + `version.json`.
4. Кнопка запуска станет активной → запускает exe → лаунчер закрывается.

## 6. Подготовка обновления 0.1.0 → 0.1.1
1. Экспортируй новую сборку игры.
2. Архивируй в `gigabah_0.1.1.zip` (полный пакет).
3. Создай новый Release: tag `v0.1.1`, прикрепи ZIP, опиши изменения.
4. Лаунчер увидит новую версию и скачает полный ZIP (патчи пока не используются).

## 7. Удаление старых файлов
Пока отсутствует отдельный механизм удаления. Если в новой версии файлы больше не нужны — выпускайте полный архив.

## 8. Настройка версии
Файл `game/version.json` пишется лаунчером автоматически после установки. Не нужно редактировать вручную на клиенте.

## 9. Авто-закрытие
Если хотите чтобы лаунчер НЕ закрывался после запуска игры — удалите строку `get_tree().quit()` в `launcher/scripts/launcher.gd`.

## 10. Диагностика проблем
| Симптом | Возможная причина | Что сделать |
|---------|------------------|------------|
| Вечный статус "Запрос последних Releases" | Проблема с GitHub API / сеть | Проверь доступ к `api.github.com` |
| Asset не найден | В релизе нет ZIP | Добавь ZIP и сделай релиз не draft |
| Прогресс сразу 0→100 | Нет стриминга в текущей сборке | Нормально, планируется улучшение |
| Версия не обновляется | Tag не SemVer / одинаковый | Измени tag на новый (vX.Y.Z) |

## 11. Рекомендуемый цикл релиза
1. Экспорт → полный ZIP.
2. Создание GitHub Release с новым тегом.
3. Прикрепление ZIP.
4. Smoke-тест лаунчером.
5. Анонс пользователям.

## 12. Минимальная безопасность
- Всегда HTTPS.
- Не меняйте содержимое уже опубликованного ZIP (иначе хэш не совпадёт).
- Можно дополнительно размещать manifest с `Cache-Control: no-cache`.
- Возможное расширение: цифровая подпись manifest и ZIP.

## 13. Быстрый чеклист перед выкладкой
- [ ] Обновлён `GITHUB_OWNER` / `GITHUB_REPO`
- [ ] Создан Release (не draft, не prerelease) с тегом новой версии
- [ ] Есть ровно один ZIP asset с полной сборкой
- [ ] Лаунчер подтянул версию и скачал архив
- [ ] Игра запускается из лаунчера

## 14. Что можно улучшить позже
- Патчи (отдельные delta ZIP)
- Удаление устаревших файлов
- Каналы (latest, beta, nightly) через фильтр по префиксу тегов
- Верификация SHA-256 (через дополнительный *.sha256 asset)
- Резюмирование скачивания / прогресс стриминга
- Локальный лог (`launcher.log`)

---
Если нужно — могу сразу внедрить поддержку удаления файлов или подписей. Напиши следующую задачу.
